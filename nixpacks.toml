# nixpacks.toml - Configuration pour déploiement Nixpacks
# https://nixpacks.com/docs/configuration/file

# Variables d'environnement de base
[variables]
  PHP_VERSION = "8.2"
  NODE_VERSION = "18"
  COMPOSER_VERSION = "2"

# Détection de l'application Laravel
[phases.setup]
  dependsOn = ["php", "node", "composer"]
  nixPkgs = ["php82", "php82Extensions.zip", "php82Extensions.mbstring", "php82Extensions pdo", "php82Extensions.pdo_pgsql", "nodejs", "yarn"]

[phases.install]
  cmds = [
    "composer install --no-dev --optimize-autoloader",
    "npm install",
    "npm run build"
  ]

[phases.build]
  cmds = [
    "php artisan config:cache",
    "php artisan route:cache",
    "php artisan view:cache"
  ]

# Configuration du démarrage
[start]
  cmd = "php artisan serve --host=0.0.0.0 --port=${PORT:-8000}"

# Variables d'environnement pour la production
[environments.production]
  variables = { APP_ENV = "production", APP_DEBUG = "false" }

# Variables pour le développement
[environments.development]
  variables = { APP_ENV = "local", APP_DEBUG = "true" }